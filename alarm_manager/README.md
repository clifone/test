# Alarm Manager

## Описание

> Демон, следящий за изменениями определенных параметров системы. В зависимости от значений сохраняются и выводятся индикации о выходе за установленные пределы.

## Список параметров

> 1. Объем используемой ОЗУ
> 2. Загруженность процессора
> 3. Объем занятого файла подкачки
> 4. Объем занятого места директории

## Структура проекта

```
.
├── include
│   ├── alarm_manager
│   │   ├── daemon.h
│   │   ├── failure.h
│   │   └── system_condition
│   │       ├── cpu_usage.h
│   │       ├── dir_usage.h
│   │       ├── mem_usage.h
│   │       ├── system_condition.h
│   │       └── usage_utils.h
│   ├── input_processing
│   │   └── input_processing.h
│   ├── IPC
│   │   ├── semaphore.h
│   │   └── shared_mem.h
│   └── utils
│       ├── program_log.h
│       └── tokenize.h
├── main.c
├── Makefile
├── README.md
└── src
    ├── alarm_manager
    │   ├── daemon.c
    │   ├── failure
    │   │   ├── failure.c
    │   │   ├── log.c
    │   │   └── popup.c
    │   └── system_condition
    │       ├── cpu_usage.c
    │       ├── dir_usage.c
    │       ├── mem_usage.c
    │       ├── system_condition.c
    │       └── usage_utils.c
    ├── input_processing
    │   ├── input_lib.c
    │   └── input_processing.c
    ├── IPC
    │   ├── semaphore.c
    │   └── shared_mem.c
    └── utils
        ├── program_log.c
        └── tokenize.c
```

## Описание файлов

Директория /include содержит заголовочные файлы, /src - исходные.

### Описание заголовочных файлов:

1. */include/alarm_manager/system_condition/cpu_usage.h*: Прототипы функций и структуры для получения информации о загруженности процессора.

1. */include/alarm_manager/system_condition/dir_usage.h*: Прототип функции получения размера директории.

1. */include/alarm_manager/system_condition/mem_usage.h*: Прототипы функций для получения размера файла подкачки или ОЗУ.

1. */include/alarm_manager/system_condition/system_condition.h*: Содержит значения параметров по умолчанию, прототипы функций для получения текущих параметров системы и установленных пределов.

1. */include/alarm_manager/system_condition/usage_utils.h*: Прототипы вспомогательных функций.

1. */include/alarm_manager/daemon.h*: Прототипы функций для манипуляций с демоном.

1. */include/alarm_manager/failure.h*: Прототипы функций, ответственных за логирование, проверку аварий и всплывающее окно.

1. */include/input_processing/input_processing.h*: Прототип функции, отвечающей за обработку пользовательского ввода.

1. */include/IPC/semaphore.h*: Прототипы функций для работы с семафорами.

1. */include/IPC/shared_mem.h*: Прототип функции для работы с разделяемой памятью.

1. */include/utils/program_log.h*: Прототип кастомной функции логирования для отладки и макрос для выключения / включения логирования. Пишется в системный лог.

1. */include/utils/tokenize.h*: Прототип парсера.

### Описание исходных файлов:

1. */src/alarm_manager/failure/failure.c*: Функция обработки аварии и гистерезиса.

1. */src/alarm_manager/failure/log.c*: Функции логирования.

1. */src/alarm_manager/failure/popup.c*: Функция всплывающего окна.

1. */src/alarm_manager/system_condition/cpu_usage.c*: Получение загруженности процессора.

1. */src/alarm_manager/system_condition/dir_usage.c*: Получение размера директории.

1. */src/alarm_manager/system_condition/mem_usage.c*: Получение размеров файла подкачки и ОЗУ.

1. */src/alarm_manager/system_condition/system_condition.c*: Получение текущих значений параметров системы, установка пределов.

1. */src/alarm_manager/system_condition/usage_utils.c*: Вспомогательные функции.

1. */src/alarm_manager/daemon.c*: Демонизация, управление демоном.

1. */src/input_processing/input_lib.c*: Функции, участвующие в обработке пользовательского ввода.

1. */src/input_processing/input_processing.c*: Обработка пользовательского ввода.

1. */src/IPC/semaphore.c*: Функции семафоров.

1. */src/IPC/shared_mem.c*: Функции разделяемой памяти.

1. */src/utils/program_log.c*: Кастомное логирование в системный лог для отладки программы.

1. */src/utils/tokenize.c*: Парсинг строки.

## Сборка

> Сборка осуществляется при помощи утилиты `make` одноименной командой.  
> Для сборки необходимо установить пакет gtk3-dev.  
> Ubuntu: `sudo apt-get install libgtk-3-dev`.  
> Arch: `sudo pacman -S gtk3 base-devel`.  
>  
> **Makefile** имеет 4 цели:
> 1. no_gtk (по умолчанию): запуск демона без использованию графического окна без системного логирования
> 2. gtk: запуск демона с использованием графического окна без системного логирования
> 3. no_gtk_log: запуск демона без использованию графического окна с системным логированием
> 4. gtk_log: запуск демона без использованию графического окна с системным логированием

## Синтаксис запуска

### ЗАПУСК

```
./alarm_manager [флаги] [параметры]
```

### ФЛАГИ

Изменить значения пределов параметров в запущенном демоне:
```
-s, --set [параметры]
```

Вывести значения указанных параметров:
```
-p, --print [параметры]
```

Вывести значения всех параметров:
```
-a, --print_all
```

 Вывести лог аварий:
```
-l, --log
```

Очистить лог аварий:
```
-d, --del_log
```

Убить демона:
```
-k, --kill
```

Вывести справку:
```
-h, --help
```

### ПАРАМЕТРЫ

Количество Кбайт (Мбайт, Гбайт) ОЗУ. Если было указано дробное значение, то произойдет конвертация в Кбайты и отброс дробной части. Значения указываются в диапазоне: [0; ram_max]:
```
-r, --ram [значение]
```

Количество процентов [0%; 100%] или часть [0; 1], показывающая загруженность процессора:
```
-c, --cpu [значение]
```

Количество Кбайт (Мбайт, Гбайт) файла подкачки. Если было указано дробное значение, то произойдет конвертация в Кбайты и отброс дробной части. Значения указываются в диапазоне: [0; swap_max]:
```
-w, --swap [значение]
```

Путь до директории:
```
-o, --dir_path [значение]
```

Количество Кбайт (Мбайт, Гбайт) директории. Если было указано дробное значение, то произойдет конвертация в Кбайты и отброс дробной части. Значения указываются в диапазоне: [0; dir_size_max]:
```
-b, --dir_size [значение]
```

**Примечание**: значения у параметров указываются только с флагом -s, --set.

## Примеры использования

Запуск демона:
```
./alarm_manager
```

Изменение ОЗУ и загруженности процессора (эквивалентные записи):
```bash
./alarm_manager --set --ram=4.5G --cpu=80%
```
```
./alarm_manager -s -r 4.5g -c 0.8
```

Вывод пути директории и объема файла подкачки:
```
./alarm_manager --print --dir_path --swap
```

Вывод логов:
```
./alarm_manager --log
```

Очистка логов:
```
./alarm_manager --del_log
```

Остановка демона:
```
./alarm_manager --kill
```
